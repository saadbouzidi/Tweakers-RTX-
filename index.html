<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RTX Hub — تسجيل محلي</title>
<style>
  :root{--accent:#8b5cf6;--accent2:#4c1d95}
  html,body{height:100%;margin:0;font-family:Segoe UI,Arial, sans-serif;background:linear-gradient(-45deg,#050008,#3b0066,#050008,#2c003e);background-size:400% 400%;animation:bgMove 14s linear infinite;color:#eef2ff}
  @keyframes bgMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  .wrap{max-width:980px;margin:28px auto;padding:20px}
  header{text-align:center;margin-bottom:18px}
  h1{margin:10px 0 4px 0;font-size:2.4rem;animation:fadeZoom .9s ease}
  .subtitle{color:#c8d7ff;opacity:.9;margin-top:4px}
  .panel{background:rgba(255,255,255,0.04);border-radius:12px;padding:18px;backdrop-filter:blur(6px);box-shadow:0 10px 40px rgba(2,6,23,0.6)}
  .login-row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  input[type="email"],input[type="password"],input[type="text"]{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;min-width:220px;text-align:center}
  button{padding:10px 14px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent2));color:white;font-weight:700;cursor:pointer;transition:transform .14s}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
  button:hover{transform:translateY(-3px)}
  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:14px;margin-top:18px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px;min-height:110px;box-shadow:0 10px 30px rgba(2,6,23,0.6);transform:translateY(20px);opacity:0;animation:cardIn .6s forwards}
  @keyframes cardIn{to{transform:translateY(0);opacity:1}}
  .card h3{margin:0 0 8px 0}
  .card p{color:#b8cff2;margin:0 0 10px}
  .small{font-size:13px;color:#c5d6ff}
  .user-bar{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:12px}
  .notice{margin-top:10px;color:#ffdede;background:rgba(107,29,29,0.14);padding:8px;border-radius:8px;display:none}
  .success{background:rgba(20,80,20,0.15);color:#d4ffd8}
  .admin-form{display:flex;flex-direction:column;gap:8px;margin-top:12px}
  .center{display:flex;justify-content:center}
  @media (max-width:640px){h1{font-size:1.6rem}.login-row input{min-width:160px}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>RTX Hub — البوابة</h1>
      <div class="subtitle">كل شيء متحرك — تسجيل محلي ثابت</div>
    </header>

    <div class="panel" id="authPanel">
      <div id="loginArea" class="center">
        <div>
          <div class="login-row">
            <input id="email" type="email" placeholder="البريد الإلكتروني" />
            <input id="password" type="password" placeholder="كلمة المرور" />
          </div>

          <div class="login-row" style="margin-top:10px">
            <button id="btnLogin">دخول</button>
            <button id="btnRegister" class="ghost">تسجيل حساب</button>
            <button id="btnLogout" class="ghost" style="display:none">خروج</button>
          </div>

          <div id="msg" class="notice" role="status"></div>
          <div class="small" style="margin-top:10px">الأونر الوحيد: <b>saadbouzidi556@gmail.com</b></div>
        </div>
      </div>

      <div id="userInfo" style="display:none;margin-top:12px">
        <div class="user-bar">
          <div id="who" class="small"></div>
          <div>
            <button id="btnShowAdmin" class="ghost" style="display:none">لوحة الأدمن</button>
            <button id="btnLogout2" class="ghost">خروج</button>
          </div>
        </div>
      </div>
    </div>

    <div id="adminPanelContainer"></div>

    <section class="cards" id="cardsContainer" aria-live="polite"></section>
  </div>

<script>
/* ======= إعدادات المستخدم المحلي ======= 
   نظام بسيط يعمل عبر localStorage (يخزن usuarios على جهاز المتصفح).
   OWNER_EMAIL هو الأونر الوحيد الذي يحصل على صلاحية "أدمن".
*/
const OWNER_EMAIL = "saadbouzidi556@gmail.com";
const DEFAULT_ADMIN_PASS = "123456"; // تقدر تغيّره في الكود لو تحب

// helpers
function getUsers(){ try { return JSON.parse(localStorage.getItem('rtx_users')||'null') || {}; } catch(e){ return {}; } }
function saveUsers(u){ localStorage.setItem('rtx_users', JSON.stringify(u)); }
function getCards(){ try { return JSON.parse(localStorage.getItem('rtx_cards')||'null') || []; } catch(e){ return []; } }
function saveCards(c){ localStorage.setItem('rtx_cards', JSON.stringify(c)); }
function setCurrentUser(email){ localStorage.setItem('rtx_current', email||''); }
function getCurrentUser(){ return localStorage.getItem('rtx_current') || ''; }
function showMsg(text,ok=false){ const el=document.getElementById('msg'); el.textContent=text; el.style.display='block'; el.className='notice '+(ok? 'success':''); setTimeout(()=>{ el.style.display='none'; el.className='notice'; },4500); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
function renderCards(){ const container=document.getElementById('cardsContainer'); const cards=getCards(); container.innerHTML=''; if(cards.length===0){ const empty=document.createElement('div'); empty.className='card'; empty.innerHTML='<h3>لا توجد بطاقات بعد</h3><p class="small">تسجيل كأدمن يسمح بإضافة بطاقات.</p>'; container.appendChild(empty); return; } let delay=0; for(const c of cards){ const el=document.createElement('div'); el.className='card'; el.style.animationDelay=(delay*90)+'ms'; el.innerHTML=`<h3>${escapeHtml(c.title)}</h3><p>${escapeHtml(c.desc||'')}</p><div class="small"><a href="${escapeHtml(c.link||'#')}" target="_blank" style="color:inherit;text-decoration:underline">تحميل / فتح</a></div>`; container.appendChild(el); delay++; } }

// تهيئة قاعدة المستخدمين الافتراضية عند أول تشغيل
(function init(){
  const users=getUsers();
  if(!users[OWNER_EMAIL]){
    users[OWNER_EMAIL] = DEFAULT_ADMIN_PASS; // حساب الأدمن الافتراضي
  }
  if(!users['guest@example.com']){
    users['guest@example.com'] = 'guest';
  }
  saveUsers(users);

  // عين بعض البطاقات تجريبية لو ما في
  if(getCards().length===0){
    saveCards([
      {title:'تويكر تجريبي', desc:'وصف تجريبي للبطاقة — اضف بطاقاتك كأدمن', link:'#'},
      {title:'عرض سريع', desc:'جرب تسجيل الدخول كأدمن لإضافة بطاقات', link:'#'}
    ]);
  }

  // إذا كان مستخدم مسجل حالياً — اعرض الواجهة المناسبة
  const cur = getCurrentUser();
  if(cur) applyUser(cur);
  renderCards();
})();

// أحداث الواجهة
document.getElementById('btnRegister').addEventListener('click', ()=> {
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('password').value;
  if(!email || !pass){ showMsg('ادخل البريد وكلمة المرور أولاً'); return; }
  const users = getUsers();
  if(users[email]){ showMsg('هذا البريد مسجل بالفعل'); return; }
  users[email] = pass;
  saveUsers(users);
  showMsg('تم إنشاء الحساب بنجاح — سجّل الدخول الآن', true);
});

document.getElementById('btnLogin').addEventListener('click', ()=> {
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('password').value;
  if(!email || !pass){ showMsg('ادخل البريد وكلمة المرور'); return; }
  const users = getUsers();
  if(users[email] && users[email] === pass){
    setCurrentUser(email);
    applyUser(email);
    showMsg('تم تسجيل الدخول', true);
    renderCards();
  } else {
    showMsg('خطأ في البريد أو كلمة المرور');
  }
});

// خروج (هناك زرين في الواجهة)
function logout(){
  setCurrentUser('');
  applyUser(null);
}
document.getElementById('btnLogout').addEventListener('click', logout);
document.getElementById('btnLogout2')?.addEventListener('click', logout);

// عرض واجهة المستخدم بعد تسجيل الدخول
function applyUser(email){
  const loginArea = document.getElementById('loginArea');
  const userInfo = document.getElementById('userInfo');
  const who = document.getElementById('who');
  const btnShowAdmin = document.getElementById('btnShowAdmin');

  if(email){
    // مستخدم متصل
    loginArea.style.display = 'none';
    userInfo.style.display = 'block';
    who.innerHTML = `<b>${escapeHtml(email)}</b>`;
    document.getElementById('btnLogout').style.display = 'none';
    document.getElementById('btnLogout2').style.display = 'inline-block';

    // صلاحية الأدمن إذا تطابق الايميل مع OWNER_EMAIL
    const isAdmin = (email === OWNER_EMAIL);
    if(isAdmin){
      btnShowAdmin.style.display = 'inline-block';
      btnShowAdmin.onclick = ()=> {
        showAdminForm();
      };
      // عرض فورم الأدمن مباشرة
      showAdminForm();
    } else {
      btnShowAdmin.style.display = 'none';
      removeAdminForm();
    }
  } else {
    // غير مسجل
    loginArea.style.display = 'block';
    userInfo.style.display = 'none';
    document.getElementById('btnLogout2').style.display = 'none';
    removeAdminForm();
  }
}

// إضافة فورم الأدمن (لوحة إضافة البطاقات)
function showAdminForm(){
  if(document.getElementById('adminForm')) return;
  const container = document.getElementById('adminPanelContainer');
  const panel = document.createElement('div');
  panel.id = 'adminForm';
  panel.className = 'panel admin-form';
  panel.innerHTML = `
    <h3>لوحة الأدمن — إضافة بطاقة جديدة</h3>
    <input id="newTitle" type="text" placeholder="عنوان البطاقة" />
    <input id="newDesc" type="text" placeholder="وصف قصير" />
    <input id="newLink" type="text" placeholder="رابط التحميل أو الصفحة" />
    <div style="display:flex;gap:8px;justify-content:center">
      <button id="addCardBtn">أضف البطاقة</button>
      <button id="clearCardsBtn" class="ghost">حذف كل البطاقات (اختياري)</button>
    </div>
  `;
  container.prepend(panel);

  document.getElementById('addCardBtn').addEventListener('click', ()=> {
    const t = document.getElementById('newTitle').value.trim();
    const d = document.getElementById('newDesc').value.trim();
    const l = document.getElementById('newLink').value.trim();
    if(!t || !l){ showMsg('أدخل عنوانًا ورابطًا للبطاقة'); return; }
    const cards = getCards();
    cards.unshift({title: t, desc: d, link: l});
    saveCards(cards);
    document.getElementById('newTitle').value=''; document.getElementById('newDesc').value=''; document.getElementById('newLink').value='';
    renderCards();
    showMsg('تمت إضافة البطاقة', true);
  });

  document.getElementById('clearCardsBtn').addEventListener('click', ()=> {
    if(!confirm('تأكيد حذف كل البطاقات؟ هذا الإجراء لا يمكن التراجع عنه.')) return;
    saveCards([]);
    renderCards();
    showMsg('حُذفت كل البطاقات', true);
  });
}

function removeAdminForm(){
  const f = document.getElementById('adminForm');
  if(f) f.remove();
}

// افتح لوحة الدخول بزر/روابط
document.getElementById('btnOpenLogin')?.addEventListener('click', ()=> {
  document.getElementById('email').focus();
});

// استمع لضغط Enter داخل الحقول لتسجيل الدخول
['email','password'].forEach(id=> {
  const el = document.getElementById(id);
  el.addEventListener('keydown', (e)=> { if(e.key==='Enter') document.getElementById('btnLogin').click(); });
});

// عرض المبدئي
renderCards();
</script>
</body>
</html>
